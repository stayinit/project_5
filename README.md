# Проектирование хранилища для сервиса аутентификации и авторизации в NoSQL СУБД
## Исходные данные:
Задача заключалась в проектировании подходящего хранилища данных для сервиса аутентификации и авторизации с использованием нереляционной СУБД. Требовалось обеспечить масштабируемость, гибкость и быстрый доступ к данным, заменив классическую реляционную базу данных на NoSQL-решение.
## Стек:
MongoDB, JSON, NoSQL моделирование данных
## Методы и подходы:
- Анализ требований к системе аутентификации и авторизации
- Сравнение типов NoSQL хранилищ для конкретного кейса
- Документное моделирование данных с балансом между встраиванием и ссылками
- Проектирование TTL-индексов для автоматической очистки временных данных
- Реализация денормализации для оптимизации частых запросов
- Разработка схем версионирования для миграций
## Реализация проекта:
1. Выбор технологии: Выбрана документная СУБД MongoDB как оптимальное решение благодаря гибкой схеме, поддержке шардирования, TTL-индексам и транзакциям.
2. Архитектура данных: Разработана структура из 9 основных коллекций:
- users - учетные записи пользователей с профилями и атрибутами
- roles - ролевая модель с привилегиями
- permissions - атомарные права доступа
- policies - ABAC-политики с условиями доступа
- sessions - активные сессии с TTL
- refresh_tokens - refresh-токены с поддержкой ротации
- devices - привязанные устройства и MFA-ключи
- audit_logs - журналы событий безопасности
- tenants - арендаторы в multi-tenant архитектуре
3. Оптимизации производительности:
- Реализовано кэширование эффективных прав пользователей в поле effective_permissions
- Использованы составные индексы для горячих запросов (email/username + tenant)
- Применены частичные индексы для оптимизации типовых операций
- Реализована стратегия инкрементального обновления ролей через role_version
4. Безопасность данных:
- Конфиденциальные данные хранятся с внешним шифрованием
- Поддержка FPE (Format-Preserving Encryption) для чувствительных полей
- TTL-автоочистка сессий и токенов
- Ведение полного аудит-трека всех операций
5. Примеры реализации: Разработаны JSON-документы для всех ключевых сущностей, демонстрирующие практическую реализацию модели данных с поддержкой multi-tenancy, RBAC/ABAC, MFA и внешних провайдеров аутентификации.